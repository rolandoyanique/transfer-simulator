<div class="dashboard">
  <h1>{{ 'DASHBOARD.TITLE' | translate }}</h1>
  
  <div *ngIf="isLoading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
  
  <div *ngIf="!isLoading">
    <!-- Estadísticas principales -->
    <div class="stats-grid">
      <mat-card class="dashboard-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>list_alt</mat-icon>
            {{ 'DASHBOARD.TOTAL_TRANSACTIONS' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h2>{{ stats.totalTransactions }}</h2>
          <p>{{ 'DASHBOARD.TODAY' | translate }}</p>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="dashboard-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>attach_money</mat-icon>
            {{ 'DASHBOARD.TOTAL_AMOUNT' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h2>{{ stats.totalAmount | currency:'USD':'symbol':'1.2-2' }}</h2>
          <p>{{ 'DASHBOARD.TODAY' | translate }}</p>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="dashboard-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>account_balance</mat-icon>
            {{ 'DASHBOARD.ACCOUNT_MOST_TRANSACTIONS' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h2>{{ getAccountName(stats.accountWithMostTransactions) }}</h2>
          <p>{{ 'DASHBOARD.MOST_ACTIVE' | translate }}</p>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="dashboard-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>trending_up</mat-icon>
            {{ 'DASHBOARD.AVERAGE_TRANSACTION' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <h2>{{ stats.averageTransaction | currency:'USD':'symbol':'1.2-2' }}</h2>
          <p>{{ 'DASHBOARD.PER_TRANSACTION' | translate }}</p>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Sección de montos por moneda -->
    <div *ngIf="getCurrencies().length > 0" class="currency-breakdown">
      <mat-card>
        <mat-card-header>
          <mat-card-title>
            <mat-icon>currency_exchange</mat-icon>
            {{ 'DASHBOARD.AMOUNT_BY_CURRENCY' | translate }}
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="currency-grid">
            <div *ngFor="let currency of getCurrencies()" class="currency-item">
              <span class="currency-label">{{ currency }}</span>
              <span class="currency-amount">{{ formatCurrencyAmount(currency) }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Gráficas -->
    <div class="charts-section">
      <h2>{{ 'DASHBOARD.CHARTS' | translate }}</h2>
      
      <!-- Gráfica 1: Transacciones por hora -->
      <div class="chart-row">
        <div class="chart-container">
          <mat-card>
            <mat-card-content>
              <canvas baseChart
                [data]="hourlyChartData"
                [options]="hourlyChartOptions"
                [type]="hourlyChartType"
                (chartHover)="chartHovered($event)"
                (chartClick)="chartClicked($event)">
              </canvas>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Gráfica 2: Transacciones por cuenta -->
        <div class="chart-container">
          <mat-card>
            <mat-card-content>
              <canvas baseChart
                [data]="accountChartData"
                [options]="accountChartOptions"
                [type]="accountChartType"
                (chartHover)="chartHovered($event)"
                (chartClick)="chartClicked($event)">
              </canvas>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Gráfica 3: Tendencia de transacciones -->
      <div class="chart-row">
        <div class="chart-container full-width">
          <mat-card>
            <mat-card-content>
              <canvas baseChart
                [data]="trendChartData"
                [options]="trendChartOptions"
                [type]="trendChartType"
                (chartHover)="chartHovered($event)"
                (chartClick)="chartClicked($event)">
              </canvas>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <!-- Gráfica 4: Monto por cuenta -->
      <div class="chart-row">
        <div class="chart-container full-width">
          <mat-card>
            <mat-card-content>
              <canvas baseChart
                [data]="amountChartData"
                [options]="amountChartOptions"
                [type]="amountChartType"
                (chartHover)="chartHovered($event)"
                (chartClick)="chartClicked($event)">
              </canvas>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Sección de controles dinámicos -->
<div class="dynamic-controls">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>auto_awesome</mat-icon>
        Controles de Reportes Dinámicos
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="controls-row">
        <button mat-raised-button 
                [color]="realTimeUpdates ? 'accent' : 'primary'"
                (click)="toggleRealTimeUpdates()">
          <mat-icon>{{ realTimeUpdates ? 'pause' : 'play_arrow' }}</mat-icon>
          {{ realTimeUpdates ? 'Pausar Actualizaciones' : 'Activar Tiempo Real' }}
        </button>

        <button mat-button (click)="refreshManually()" [disabled]="isLoading">
          <mat-icon>refresh</mat-icon>
          Actualizar Ahora
        </button>

        <button mat-raised-button color="primary" (click)="printDashboardReport()" [disabled]="isLoading">
          <mat-icon>dashboard</mat-icon>
          Imprimir Dashboard
        </button>

        <button mat-raised-button color="accent" (click)="printPerformanceReport()" [disabled]="isLoading">
          <mat-icon>analytics</mat-icon>
          Reporte de Rendimiento
        </button>

        <span class="last-update">
          <mat-icon>schedule</mat-icon>
          Última actualización: {{ lastUpdate | date:'medium' }}
        </span>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<!-- Filtros dinámicos -->
<app-dynamic-filters></app-dynamic-filters>

<!-- Nuevas secciones de reportes dinámicos -->
<div class="dynamic-reports">
  <!-- Resumen semanal -->
  <div class="report-row">
    <div class="report-container">
      <mat-card class="weekly-summary">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>date_range</mat-icon>
            Resumen Semanal (Semana {{ stats.weeklySummary.weekNumber }})
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="weekly-stats">
            <div class="stat-item">
              <span class="stat-label">Transacciones</span>
              <span class="stat-value">{{ stats.weeklySummary.totalTransactions }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Monto Total</span>
              <span class="stat-value">{{ stats.weeklySummary.totalAmount | currency:'USD':'symbol':'1.2-2' }}</span>
            </div>
            <div class="stat-item comparison" [class]="getWeeklyComparisonClass()">
              <mat-icon>{{ getWeeklyComparisonIcon() }}</mat-icon>
              <span>{{ formatComparison(stats.weeklySummary.comparisonWithPreviousWeek) }}</span>
              <span>vs semana anterior</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Métricas de performance -->
    <div class="report-container">
      <mat-card class="performance-metrics">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>speed</mat-icon>
            Métricas de Rendimiento
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="metrics-grid">
            <div class="metric-item">
              <mat-icon>flash_on</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Velocidad de Transacciones</span>
                <span class="metric-value">{{ stats.performanceMetrics.transactionVelocity | number:'1.1-1' }}/hora</span>
              </div>
            </div>
            <div class="metric-item">
              <mat-icon>attach_money</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Tamaño Promedio</span>
                <span class="metric-value">{{ stats.performanceMetrics.averageTransferSize | currency:'USD':'symbol':'1.2-2' }}</span>
              </div>
            </div>
            <div class="metric-item">
              <mat-icon>schedule</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Horas Pico</span>
                <span class="metric-value">{{ stats.performanceMetrics.peakActivityHours.join(', ') }}</span>
              </div>
            </div>
            <div class="metric-item">
              <mat-icon>check_circle</mat-icon>
              <div class="metric-info">
                <span class="metric-label">Tasa de Éxito</span>
                <span class="metric-value">{{ stats.performanceMetrics.successRate }}%</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

 <!-- Gráfica de tendencia en tiempo real -->
<div class="report-row">
  <div class="report-container full-width">
    <mat-card>
      <mat-card-header>
        <mat-card-title>
          <mat-icon>show_chart</mat-icon>
          Tendencia en Tiempo Real (Últimas 24 horas)
          <span *ngIf="realTimeUpdates" class="real-time-indicator">
            <mat-icon>circle</mat-icon>
            EN VIVO
          </span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas baseChart
                  [data]="hourlyChartData"
                  [options]="realTimeChartOptions"
                  [type]="'line'"
                  (chartHover)="chartHovered($event)"
                  (chartClick)="chartClicked($event)"
                  class="real-time-chart">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
</div>